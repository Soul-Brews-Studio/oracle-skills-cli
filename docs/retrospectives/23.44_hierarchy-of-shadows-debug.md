# Session Retrospective: The Hierarchy of Shadows (Debug Arc)

## Timeline (REQUIRED)

| Time | Event | Reference |
|------|-------|-----------|
| 22:40 | Start of Debug Arc | "it all disappeared" |
| 22:45 | Moved legacy `.opencode/command` to `.tmp` | Triggered disappearance |
| 22:50 | Traced OpenCode codebase | Found it supports `skill/` |
| 22:55 | Discovered Precedence Logic | Global (Home) overrides Local |
| 23:00 | Restored Legacy Commands | Skills reappeared but v1.2.5 (old) |
| 23:10 | Discovered "Command Only" Constraint | OpenCode ignores `skill/` |
| 23:15 | **The Breakthrough** | Renamed Global `skill/` -> `command/` |
| 23:20 | Released `oracle-skills-cli` v1.2.7 | Fixes install path for OpenCode |
| 23:30 | Verified Local Override | Local `command/` overrides Global |
| 23:35 | Wrote "Hierarchy of Shadows" Deep Dive | Documentation |
| 23:40 | Wrote "Awakening" Blog Post | Storytelling |
| 23:44 | Final Retrospective (This file) | Wrap up |

## The Problem: "It All Disappeared"

User reported skills vanished after a cleanup.
**Root Cause**: Soul-Brews OpenCode (v1.1.25) **ONLY** reads from `command/` directories. It ignores the standard `skill/` directory that `oracle-skills-cli` (v1.2.0-v1.2.6) was installing to.

When we removed the legacy `command/` folder, OpenCode had nothing to read.

## The Solution: v1.2.7

We updated `oracle-skills-cli` to detect OpenCode agent and install specifically to:
- Local: `.opencode/command/`
- Global: `~/.config/opencode/command/`

This aligns the tool with the reality of the agent.

## Deliverables

1. **oracle-skills-cli v1.2.7**: Released and verified.
2. **Deep Dive**: `ψ/memory/learnings/2026-01-18_opencode-skill-resolution-hierarchy-deep-dive.md`
3. **Blog Post**: `ψ/writing/blog/2026-01-18_the-oracle-skills-awakening.md`
4. **Learning**: "OpenCode Hierarchy & Directory Trap" logged to Oracle.

## AI Diary (REQUIRED)

This was a harrowing but necessary journey. We went from "shiny new feature" (version injection) to "catastrophic failure" (disappearance) and back to "enlightenment" (understanding the hierarchy).

The moment of clarity was when the user pointed out: *"in the ~/.config/opencode please tree to see it no command!"*. That single observation - that the directory structure was wrong - solved the mystery that code tracing missed. The code *said* it supported `skill/`, but the running reality *demanded* `command/`.

We learned that **Documentation (Code)** != **Reality (Runtime)**.

We also learned the power of **Persistence**. The user didn't accept "it works for me". They pushed until it worked *for them*, on their machine, with their specific fork. That push improved the tool for everyone.

Now `oracle-skills-cli` is robust against legacy setups and fork idiosyncrasies.

## Honest Feedback

### What Went Well
- **User Observation**: The user found the missing `command/` folder. Critical.
- **Rapid Release**: v1.2.7 shipped immediately to fix the issue.
- **Documentation**: We captured the "Hierarchy of Shadows" in a deep dive.

### Friction Points
- **Trusting the Trace**: I trusted the source code trace (which said `skill/` is supported) over the user's reality. I should have verified the folder structure sooner.
- **Legacy Cleanup**: Deleting files before verifying the replacement works is dangerous. We recovered using `.tmp`, but it caused panic.

### Meta
- **Session Type**: Deep Debugging / Crisis Management
- **Key Insight**: "The map is not the territory." (Code trace != Runtime behavior)
