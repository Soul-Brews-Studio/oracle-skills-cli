# Session Retrospective

**Session Date**: 2026-02-01
**Start Time**: ~12:00 GMT+7
**End Time**: 14:28 GMT+7
**Duration**: ~2.5 hours
**Primary Focus**: /worktree skill creation + installer improvements
**Session Type**: Feature Development

## Session Summary

Created a new `/worktree` skill for managing git worktrees for parallel agent work, plus improved the installer to auto-cleanup orphaned skills. The worktree skill evolved through several iterations based on user feedback, ultimately settling on a simple, clean design using sibling worktrees to avoid VS Code indexing issues.

## Timeline

- 12:16 - Deep trace on "maw and git worktree" with 5 parallel agents
- 12:30 - User suggested creating /worktree skill like Claude Code Desktop
- 12:35 - Entered plan mode, designed skill approach
- 12:45 - Created initial /worktree skill with nested agents/ structure
- 12:50 - User feedback: VS Code indexes nested files - redesigned to sibling structure
- 13:00 - Updated to create worktrees at `repo.wt/N` (siblings, not nested)
- 13:15 - Simplified list output - user preferred simple `git worktree list`
- 13:30 - Added installer auto-cleanup for orphaned skills (checks `installer:` marker)
- 14:00 - Released v1.5.48, v1.5.49, v1.5.50 with incremental improvements
- 14:20 - Cleaned up test worktrees, final release

## Technical Details

### Files Modified

```
src/skills/worktree/SKILL.md (new)
src/commands/worktree.md (new)
src/cli/installer.ts (improved orphan cleanup)
src/skills/learn/SKILL.md (added --fast/--deep modes)
src/skills/who-we-are/SKILL.md (renamed from who-are-we)
```

### Key Code Changes

- **worktree skill**: New skill for git worktree management
  - `/worktree` - list all worktrees
  - `/worktree new` - create sibling worktree at `repo.wt/N`
  - `/worktree remove N` - remove worktree
- **installer.ts**: Added `isOurSkill()` function to check for `installer: oracle-skills-cli` marker, only cleans up our orphaned skills
- **learn skill**: Added `--fast` (1 agent) and `--deep` (5 agents) depth modes

### Architecture Decisions

- **Sibling worktrees**: Created at `repo.wt/N` instead of `repo/agents/N` to prevent VS Code from indexing all worktree files when opening main repo
- **Auto-numbered agents**: Uses `agents/1`, `agents/2` branch naming convention (MAW-compatible)
- **Installer marker**: Uses `installer: oracle-skills-cli` in frontmatter to identify our skills for cleanup

## AI Diary

This session was a fascinating exercise in iterative design based on real-time user feedback. I started by doing a deep trace on "maw and git worktree" which revealed the Multi-Agent Workflow Kit architecture and its worktree-based approach to parallel agent development.

When the user suggested creating a worktree skill, I initially designed it with nested worktrees (`agents/1`, `agents/2` inside the repo). This seemed logical until the user pointed out a critical issue: VS Code would index all those nested directories, making the IDE slow and cluttered.

The redesign to sibling worktrees (`repo.wt/1`, `repo.wt/2`) was elegant - each worktree becomes its own VS Code workspace, completely isolated from the main repo. This aligns with the MAW philosophy of "each agent = own branch + directory".

I also appreciated how the user pushed back on over-engineering. When I created fancy table formatting for the worktree list, they said "the native git worktree list output is already good enough." This was a good reminder that simplicity often wins.

The installer improvement to auto-cleanup orphaned skills was satisfying to implement. Using the `installer: oracle-skills-cli` marker means we only clean up our own mess, never touching skills from other sources.

## What Went Well

- Fast iteration cycle: plan → implement → test → user feedback → improve
- Clean separation of worktrees as siblings
- Installer now properly cleans up renamed/deleted skills
- User feedback drove simplification (less fancy tables, more native output)

## What Could Improve

- Initial design didn't consider VS Code indexing implications
- Could have asked about IDE behavior earlier in planning
- Multiple releases (v1.5.48, 49, 50) for what could have been one

## Blockers & Resolutions

- **Blocker**: Nested worktrees get indexed by VS Code
  **Resolution**: Redesigned to sibling worktrees at `repo.wt/N`

- **Blocker**: Leftover `agents/1` branch from testing
  **Resolution**: Deleted branch before creating new worktree

## Honest Feedback

The session was productive but could have been more efficient with better upfront requirements gathering. The worktree skill went through 3-4 design iterations that could have been avoided by asking about VS Code/IDE behavior at the start.

The user's feedback style is excellent - direct and focused on practical concerns. When they said "but when i open with vs code it allways index all nested files?" it immediately clarified the real constraint I had missed.

The release cadence was perhaps too aggressive - three versions (1.5.48, 49, 50) in one session for incremental improvements. A single well-thought-out release would have been cleaner.

### Friction Points

1. **VS Code indexing not considered**: Initial design failed to account for IDE behavior with nested directories. Should ask about IDE/editor workflows earlier.

2. **Over-engineering output formatting**: Spent time on fancy table formatting that the user found unnecessary. Native command output was preferred.

3. **Multiple micro-releases**: Three version bumps for what was essentially one feature. Could consolidate changes into fewer releases.

## Lessons Learned

- **Pattern**: Sibling worktrees > nested worktrees for IDE compatibility
- **Discovery**: Users often prefer native command output over custom formatting
- **Practice**: Ask about IDE/editor workflows when designing file-based features

## Next Steps

- [ ] Document worktree skill in README
- [ ] Consider adding `/worktree sync` for MAW-style synchronization
- [ ] Test worktree workflow in actual multi-agent scenario

## Metrics

- **Commits**: 4 (v1.5.48, v1.5.49, v1.5.50, plus minor)
- **Files changed**: ~40
- **New skill**: /worktree
- **Skills modified**: /learn (depth modes), /who-we-are (renamed)
- **Installer improved**: orphan cleanup with marker check

## Retrospective Validation Checklist

- [x] AI Diary section has detailed narrative (not placeholder)
- [x] Honest Feedback section has frank assessment (not placeholder)
- [x] Timeline includes actual times and events
- [x] 3 Friction Points documented
- [x] Lessons Learned has actionable insights
- [x] Next Steps are specific and achievable
