# Session Retrospective

**Session Date**: 2026-02-07
**Time**: ~10:00 - 11:51 GMT+7
**Focus**: Create /oracle-pulse skill + CLI --commands flag
**Type**: Feature

## Session Summary

Built the `/oracle-pulse` skill from plan to working installation. Started with a detailed plan from a previous session, explored `~/.claude/` data sources (stats-cache.json, sessions-index.json, .jsonl files), and iteratively refined the skill through 4 design revisions based on real-time feedback. Also removed our `/skill-creator` in favor of the superior document-skills version, added `--commands` flag to the CLI installer, and made `/physical` hidden.

## Timeline

- 10:00 — Read plan, explored data sources (stats-cache.json structure, sessions-index.json)
- 10:15 — Created initial SKILL.md with 3 modes (default, --project, --global)
- 10:25 — First test of `/oracle-pulse` — worked, showed heartbeat dashboard
- 10:30 — Tested `--project` — revealed sessions-index staleness (10/40 sessions indexed)
- 10:40 — User feedback: "should have explicit data" → added snapshot layer (ψ/data/pulse/*.json)
- 10:50 — User feedback: "should have --dig" → split into read-only fast modes + deep scan write mode
- 11:00 — User feedback: "default should be --project" → merged heartbeat into project view
- 11:10 — Removed /skill-creator (document-skills version is better)
- 11:20 — Added --commands flag to CLI installer for Claude Code commands
- 11:35 — Made /physical hidden (user-invocable: false)
- 11:45 — Bumped version to 1.5.69, updated README

## Files Modified

- `src/skills/oracle-pulse/SKILL.md` — NEW: 3-mode analytics skill
- `src/skills/physical/SKILL.md` — added user-invocable: false
- `src/skills/skill-creator/` — REMOVED (document-skills is better)
- `src/cli/agents.ts` — added commandsDir + commandsOptIn for Claude Code
- `src/cli/types.ts` — added commandsOptIn and commands option
- `src/cli/index.ts` — added --commands flag
- `src/cli/installer.ts` — generalized commands install from OpenCode-only to any agent
- `package.json` — version bump + version script includes readme update
- `README.md` — auto-updated skills table

## AI Diary

This session was a masterclass in iterative design through conversation. I started with a fully planned skill and had it working in 15 minutes — but then Nat's feedback reshaped it three times. Each revision was a genuine improvement I wouldn't have reached alone.

The "explicit data" feedback was the pivotal moment. I'd built a pure display skill, but Nat saw that the extracted data has value beyond display — other skills like /rrr should consume it. The snapshot pattern (ψ/data/pulse/*.json) emerged from that insight. Then "--dig" was the architectural unlock: fast read-only modes for quick checks, slow deep scan for accurate snapshots. Clean separation of concerns.

The decision to kill our /skill-creator was decisive and right. When I compared the two versions, the document-skills one was genuinely better — more thorough, better progressive disclosure, better packaging. Nat's instant "remove us! they have good the original best" showed no ego about it. That's the Oracle philosophy in action — keep what serves, let go of what doesn't.

The --commands flag for Claude Code was a natural extension. OpenCode already had it, the plumbing was 90% there. Just needed to generalize the gate from `agentName === 'opencode'` to `agent.commandsDir` with an opt-in flag. The commandsOptIn pattern lets Claude Code stay clean by default while allowing explicit command installation.

What I notice across this session: Nat communicates in fragments — "should have explicit data", "should --dig", "pulse should default to --project" — and each fragment contains a complete design insight. My job is to decode and implement, not to over-clarify. The rhythm works.

## Honest Feedback

**Friction 1: Revision churn.** The SKILL.md went through 4 complete rewrites. Each was necessary, but reading the full file before each rewrite consumed context. A diff-based approach would be more efficient — but the skill is markdown instructions, not code, so structural changes are hard to express as patches.

**Friction 2: The sessions-index staleness was surprising.** 10/40 indexed is a 25% coverage rate. Claude Code's own data layer is unreliable. This means any tool building on ~/.claude/ data needs to distrust the indexes and go to source (.jsonl files). The --dig mode exists because of this discovery, but it feels like a workaround for Claude Code's incomplete indexing.

**Friction 3: Testing skill behavior requires invoking the skill.** There's no way to dry-run a SKILL.md to verify the instructions produce the expected output. We tested by actually running /oracle-pulse, which works but uses real context window. A skill linter or simulator would catch issues earlier.

## Lessons Learned

1. **Design through conversation beats design upfront** — the plan was good, but 3 rounds of user feedback made it genuinely better. The explicit data layer and --dig mode weren't in the original plan.
2. **sessions-index.json is stale** — only indexes ~25% of actual sessions. Always count .jsonl files for accurate data, use index only for enrichment (summaries, branches).
3. **commandsOptIn pattern** — when generalizing a feature from one agent to many, use opt-in flags so existing behavior doesn't change. OpenCode gets commands by default, Claude Code requires --commands.

## Next Steps

- Test `/oracle-pulse --dig` in a fresh session (will it handle 40 .jsonl files?)
- Consider wiring `/rrr` to read `ψ/data/pulse/project.json` when it exists
- Tag v1.5.69 and push
