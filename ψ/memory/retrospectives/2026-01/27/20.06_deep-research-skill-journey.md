# Session Retrospective

**Session Date**: 2026-01-27
**Start Time**: 19:15 GMT+7
**End Time**: 20:06 GMT+7
**Duration**: ~51 minutes
**Primary Focus**: Deep Research Button + Skill Creation + Installation Pattern
**Session Type**: Feature Development + Learning
**Last Commit**: 320961b forward: watch-mqtt-complete + future modes

## Session Summary

This session evolved from a simple request to add a Deep Research button to the Gemini Proxy extension into a deep dive on DOM manipulation in modern frameworks, skill creation patterns, and the critical difference between manual copying vs proper installer usage. We successfully created the `/deep-research` skill, integrated it with `/gemini`, and documented multiple lessons learned.

## Timeline

- 19:15 - Continued from previous session, ran /recap
- 19:16 - Added Canvas (ðŸ“„) and Deep Research (ðŸ”¬) buttons to content.js
- 19:20 - User reported auto-post on extension reload - added stale message protection (connectedAt timestamp)
- 19:25 - Removed Canvas button (URL works), kept only Deep Research
- 19:30 - Deep Research button shows dropdown but doesn't click the row
- 19:35 - Multiple attempts: DOM walking, parent clicking, mousedown/mouseup events
- 19:45 - **Breakthrough**: Coordinate-based clicking with `elementFromPoint()` (v2.9.39)
- 19:50 - Full automation flow working: new tab â†’ select mode â†’ chat â†’ start research
- 19:55 - Created `/deep-research` skill with SKILL.md and script
- 19:58 - Discovered skill showing as "(user)" - wrong installation method!
- 20:00 - Learned proper installer usage: `bun run src/cli/index.ts install -y -g`
- 20:02 - Skills now show `v1.5.39 G-SKLL |` format, auto-reload works
- 20:04 - Wrote blog post and logged learnings to Oracle
- 20:06 - Added /learn and /trace documentation to Oracle

## Technical Details

### Files Modified

**claude-browser-proxy (v2.9.34 â†’ v2.9.39):**
- `content.js` - Added ðŸ”¬ Deep Research button
- `background.js` - Added `select_mode` action with coordinate-based clicking
- `manifest.json` - Version bumps

**oracle-skills-cli:**
- `src/skills/deep-research/` - New skill (SKILL.md + scripts/)
- `src/skills/gemini/SKILL.md` - Added research, model, canvas subcommands
- `src/skills/gemini/scripts/deep-research.ts` - Automation script
- `src/skills/watch/SKILL.md` - Added alias notation
- `CLAUDE.md` - Documented skill creation and installation patterns
- `docs/blog/2026-01-27_deep-research-journey.md` - Full session blog

### Key Code Changes

**Coordinate-based clicking (the breakthrough):**
```javascript
const rect = textEl.getBoundingClientRect();
const x = rect.left + rect.width / 2;
const y = rect.top + rect.height / 2;
const clickTarget = document.elementFromPoint(x, y);
clickTarget.dispatchEvent(new MouseEvent('click', {
  bubbles: true, clientX: x, clientY: y
}));
```

**Stale message protection:**
```javascript
let connectedAt = 0;
client.on('connect', () => { connectedAt = Date.now(); });
client.on('message', (topic, msg) => {
  if (command.ts < connectedAt) return; // Ignore stale
});
```

### Architecture Decisions

1. **`elementFromPoint()` over DOM walking**: Modern frameworks like Angular Material have invisible overlays - find what's actually at coordinates
2. **Skill as alias**: `/deep-research` is alias to `/gemini research` - keeps `/gemini` as central hub
3. **Installer over manual copy**: Proper metadata injection and auto-reload

## ðŸ“ AI Diary

This session was a rollercoaster of "almost working" moments that taught me humility about modern web frameworks. I started confidently adding buttons, thinking "how hard can clicking a menu item be?" The answer: surprisingly hard when dealing with Angular Material's DOM structure.

My initial attempts with `.click()` did nothing. Walking up the DOM tree to find "clickable parents" still failed. Even dispatching mousedown/mouseup events didn't help. I was genuinely puzzled - the element was right there, I could see it, but nothing I threw at it worked.

The breakthrough came when I shifted perspective: instead of asking "what element should I click?", I asked "what element is actually receiving clicks at these coordinates?" Using `elementFromPoint()` revealed that the visual element wasn't the clickable one - there was likely an overlay or event delegation happening.

The second major lesson was about skill installation. I naively copied files to `~/.claude/skills/` and wondered why they showed as "(user)" without version prefixes. Reading through `installer.ts` revealed the metadata injection that makes skills look professional. The installer adds `v1.5.39 G-SKLL |` prefix and triggers auto-reload - something manual copy completely bypasses.

I feel like I've leveled up in both DOM manipulation and understanding the oracle-skills-cli architecture today.

## What Went Well

- Coordinate-based clicking breakthrough solved a tricky problem
- Full automation flow works smoothly
- Proper skill installation pattern now documented
- Multiple learnings logged to Oracle
- Blog post captures the full journey

## What Could Improve

- Should have read `installer.ts` first before manually copying
- Version bumping got tedious (2.9.34 â†’ 2.9.39 in one session)
- Could have tested `elementFromPoint` approach earlier

## Blockers & Resolutions

- **Blocker**: Deep Research menu item not clicking
  **Resolution**: `elementFromPoint()` + coordinate-based MouseEvent dispatch

- **Blocker**: Skill showing as "(user)" format
  **Resolution**: Use proper installer instead of manual copy

## ðŸ’­ Honest Feedback

This session highlighted both the power and frustration of working with third-party web UIs. Gemini's Material Design implementation is clean visually but opaque programmatically. There's no documentation for "how to programmatically click this menu item" - you just have to experiment.

The skill installation discovery was embarrassing in hindsight. The installer was right there in `src/cli/installer.ts`, and I should have checked how existing skills were installed before reinventing the wheel with `cp -r`. The lesson here is: when something looks different (user format vs G-SKLL format), investigate the difference before proceeding.

The session flow was good - we iterated quickly through versions, tested each change, and documented what worked. The coordinate-clicking solution is elegant and generalizable to other stubborn UI elements.

### Friction Points

1. **DOM opacity**: No way to know Angular Material's internal event handling without experimentation - wasted time on approaches that couldn't work
2. **Version management**: Bumping version in 3 files (manifest.json, background.js, content.js) for each attempt is tedious - should be automated
3. **Installer discovery**: The installer's role in metadata injection wasn't obvious from project structure - had to read code to understand

## Lessons Learned

- **Pattern**: `elementFromPoint()` for modern framework clicking - when DOM walking fails, find what's actually at the coordinates
- **Mistake**: Manual `cp` to ~/.claude/skills/ - always use the installer for proper metadata
- **Discovery**: Skills can be aliases via `alias:` frontmatter field - keeps architecture clean

## Next Steps

- [ ] Commit all changes to oracle-skills-cli
- [ ] Push claude-browser-proxy v2.9.39
- [ ] Test /deep-research skill end-to-end
- [ ] Consider automating version bumps in extension

## Metrics

- **Extension versions**: 6 (2.9.34 â†’ 2.9.39)
- **New skill**: 1 (/deep-research)
- **Oracle learnings**: 3
- **Blog post**: 1
- **Files changed**: ~15

## âœ… Retrospective Validation Checklist

- [x] AI Diary section has detailed narrative (not placeholder)
- [x] Honest Feedback section has frank assessment (not placeholder)
- [x] Timeline includes actual times and events
- [x] 3 Friction Points documented
- [x] Lessons Learned has actionable insights
- [x] Next Steps are specific and achievable
